@startuml
title Seller Nexus - Sequence Diagram with Design Patterns

actor Seller
participant "WebApp UI" as UI
participant "JoomTransferService" as Service
participant "<<Singleton>>\nApiClientConfigManager" as Config
participant "PlatformApiStrategyFactory\n<<Factory>>" as StrategyFactory
participant "JoomApiStrategy\n<<Strategy>>" as JoomStrategy
participant "<<Builder>>\nPlatformCredential.Builder" as Builder
participant "<<Observer>>\nTransferEventPublisher" as EventPublisher
participant "<<Observer>>\nTransferEventListener" as EventListener
participant "TransferLog" as Log

== Initialization (Singleton Pattern) ==
Service -> Config : getInstance()
activate Config
Config --> Service : return singleton instance
note right: **SINGLETON PATTERN**\nSingle configuration\ninstance for all API calls
deactivate Config

== Login and Platform Selection ==
Seller -> UI : Enter credentials & select platforms
activate UI
UI -> Service : authenticateUser(email, password)
activate Service
Service --> UI : authenticationSuccess
deactivate Service
UI --> Seller : Show Dashboard
deactivate UI

== Store Platform Credentials (Builder Pattern) ==
Seller -> UI : Connect Joom platform
activate UI
UI -> Service : storePlatformCredentials(sellerId, platform, apiKey)
activate Service
Service -> Builder : builder()
activate Builder
Builder -> Builder : platform("JOOM")
Builder -> Builder : seller(user)
Builder -> Builder : apiKey(key)
Builder -> Builder : apiSecret(secret)
Builder -> Builder : accessToken(token)
Builder -> Service : build()
deactivate Builder
note right: **BUILDER PATTERN**\nFluent interface for\ncomplex credential object
Service --> UI : credentialsStored
deactivate Service
UI --> Seller : Platform connected
deactivate UI

== Start Transfer (Observer Pattern) ==
Seller -> UI : Select products and start transfer
activate UI
UI -> Service : transferProduct(sellerId, sourceCredId, targetCredId, productId)
activate Service

Service -> EventPublisher : publishTransferStarted(sellerId, "JOOM", "AMAZON", 1)
activate EventPublisher
EventPublisher -> EventListener : handleTransferEvent(TransferEvent)
activate EventListener
EventListener --> EventListener : log("Transfer started")
deactivate EventListener
note right: **OBSERVER PATTERN**\nDecoupled event notifications\nfor real-time updates
deactivate EventPublisher

== Fetch Product (Strategy Pattern) ==
Service -> StrategyFactory : getStrategy("JOOM")
activate StrategyFactory
StrategyFactory --> Service : return JoomApiStrategy
deactivate StrategyFactory
note right: **STRATEGY PATTERN**\nRuntime selection of\nplatform-specific algorithm

Service -> JoomStrategy : fetchProductById(credential, productId)
activate JoomStrategy
JoomStrategy -> Config : getRestTemplate()
activate Config
Config --> JoomStrategy : return RestTemplate
deactivate Config
JoomStrategy -> JoomStrategy : createHeaders(credential)
JoomStrategy --> Service : return productData
deactivate JoomStrategy

Service -> EventPublisher : publishProductsFetched(sellerId, "JOOM", 1)
activate EventPublisher
EventPublisher -> EventListener : handleTransferEvent(TransferEvent)
activate EventListener
EventListener --> EventListener : log("Products fetched")
deactivate EventListener
deactivate EventPublisher

== Upload to Destination (Strategy Pattern) ==
Service -> StrategyFactory : getStrategy("AMAZON")
activate StrategyFactory
StrategyFactory --> Service : return AmazonApiStrategy
deactivate StrategyFactory

Service -> Service : buildCreatePayload(productData)

Service -> JoomStrategy : createProduct(targetCredential, payload)
activate JoomStrategy
JoomStrategy --> Service : return createResponse
deactivate JoomStrategy

Service -> EventPublisher : publishProductUploaded(sellerId, productId, 1, 1)
activate EventPublisher
EventPublisher -> EventListener : handleTransferEvent(TransferEvent)
activate EventListener
EventListener --> EventListener : log("Product uploaded: 100%")
deactivate EventListener
deactivate EventPublisher

== Completion and Logging (Observer Pattern) ==
Service -> Log : save(transferLog)
activate Log
Log --> Service : logSaved
deactivate Log

Service -> EventPublisher : publishTransferCompleted(sellerId, 1, 1, 0)
activate EventPublisher
EventPublisher -> EventListener : handleTransferEvent(TransferEvent)
activate EventListener
EventListener --> EventListener : log("Transfer completed")
deactivate EventListener
deactivate EventPublisher

Service --> UI : transferComplete(response)
deactivate Service
UI --> Seller : Show success message
deactivate UI

note over Seller, EventListener
    **5 DESIGN PATTERNS DEMONSTRATED:**
    1. Singleton: ApiClientConfigManager (single instance)
    2. Builder: PlatformCredential.Builder (fluent construction)
    3. Observer: Event Publisher/Listener (decoupled notifications)
    4. Factory: Strategy selection (not shown in detail)
    5. Strategy: Platform-specific API implementations
end note

@enduml
